<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTDMapper3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.salem.domain.Mapper.PaymentMapper">
	
	<select id="showDetailPayment" resultType="PaymentVO" parameterType="int">
		SELECT pay.paymentNo, s.sitterNo, t.sittingType, s.sitterName, s.sitterPhone, s.sitterAddress, 
				u.userName, u.userAddress, p.petNo, p.petName, b.dogBreed, b.size, pay.startTime, 
				pay.endTime, pay.request, pay.paymentMethod, pay.amount, pay.paymentDate  
		FROM USERS u
		INNER JOIN PET p ON p.userNo = u.userNo
		INNER JOIN BREED b ON b.breedNo = p.breedNo
		INNER JOIN reservation r ON p.petNo = r.petNo
		INNER JOIN payment pay ON pay.paymentNo = r.paymentNo
		INNER JOIN SITTER s ON s.sitterNo = pay.sitterNo
		INNER JOIN SITTING_TYPE t ON t.sittingNo = s.sittingNo
		WHERE pay.paymentNo=#{paymentNo}
	</select>
	
	<insert id="addPayment" parameterType="PaymentVO">
		INSERT INTO payment (sitterNo, startTime, endTime, request,  
							paymentStatus, amount, paymentDate, paymentMethod, refundStatus, reviewStatus)
		VALUES (#{sitterNo}, #{startTime}, #{endTime}, #{request}, 1, #{amount},
				sysdate(), #{paymentMethod}, 0, 0)
	</insert>
	
	<select id="showUserPayment" resultType="PaymentVO" parameterType="int">
		SELECT pay.paymentNo, s.sitterNo, t.sittingType, s.sitterName, s.sitterPhone, s.sitterAddress, 
				u.userNo, u.userName, u.userAddress, p.petNo, p.petName, b.dogBreed, b.size, pay.startTime, pay.endTime, pay.request, 
				pay.paymentMethod, pay.amount, pay.paymentStatus , pay.refundStatus, pay.reviewStatus, pay.paymentDate
		FROM USERS u
		INNER JOIN PET p ON p.userNo = u.userNo
		INNER JOIN BREED b ON b.breedNo = p.breedNo
		INNER JOIN reservation r ON p.petNo = r.petNo
		INNER JOIN payment pay ON pay.paymentNo = r.paymentNo
		INNER JOIN SITTER s ON s.sitterNo = pay.sitterNo
		INNER JOIN SITTING_TYPE t ON t.sittingNo = s.sittingNo
		WHERE u.userNo = #{userNo};
	</select>

	<select id="showAllPayment" resultType="PaymentVO">
		SELECT pay.paymentNo, s.sitterNo, t.sittingType, s.sitterName, s.sitterPhone, s.sitterAddress, 
				u.userNo, u.userName, u.userAddress, p.petNo, p.petName, b.dogBreed, b.size, pay.startTime, pay.endTime, pay.request, 
				pay.paymentMethod, pay.amount, pay.paymentStatus , pay.refundStatus, pay.reviewStatus, pay.paymentDate
		FROM USERS u
		INNER JOIN PET p ON p.userNo = u.userNo
		INNER JOIN BREED b ON b.breedNo = p.breedNo
		INNER JOIN reservation r ON p.petNo = r.petNo
		INNER JOIN payment pay ON pay.paymentNo = r.paymentNo
		INNER JOIN SITTER s ON s.sitterNo = pay.sitterNo
		INNER JOIN SITTING_TYPE t ON t.sittingNo = s.sittingNo
	</select>
	
	<select id="test1" resultType="TestVO" parameterType="string">
		select u.userName, u.userEmail, u.userPhone, u.userAddress, pay.paymentNo, pay.startTime, pay.endTime, s.sitterName,s.sitterPhone, st.sittingType
        from users u 
        inner join pet p on u.userNo=p.userNo
        inner join reservation r on p.petNo=r.petNo
        inner join payment pay on pay.paymentNo=r.paymentNo
        inner join sitter s on s.sitterNo=pay.sitterNo
        inner join sitting_type st on st.sittingNo=s.sittingNo
        where 
        DATE_FORMAT(pay.paymentDate, "%Y-%m-%d") = curdate();
    </select>
	
</mapper>
